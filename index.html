<!DOCTYPE html>
<html>
  <head>
    <title>CS:GO Case Opening</title>
    <meta name="zxcv drop" content="width=device-width, initial-scale=1" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      :root {
        --bg-color: #1e1e1e;
        --case-color: #2a2a2e;
        --primary: #5d8aff;
        --rare: #ffcc00;
        --legendary: #ff4d4d;
      }
      body {
        font-family: "Arial", sans-serif;
        background: var(--bg-color);
        color: white;
        margin: 0;
        padding: 0;
      }
      .header {
        display: flex;
        justify-content: space-between;
        padding: 15px;
        background: #2a2a2a;
      }
      .balance {
        background: var(--primary);
        padding: 5px 10px;
        border-radius: 10px;
        font-weight: bold;
      }
      .case {
        background: var(--case-color);
        border-radius: 15px;
        margin: 15px;
        padding: 15px;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      }
      .case-image {
        width: 200px;
        height: 150px;
        object-fit: contain;
        margin-bottom: 10px;
      }
      .open-btn {
        background: var(--primary);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 100;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: var(--case-color);
        padding: 20px;
        border-radius: 15px;
        width: 80%;
        max-width: 400px;
      }
      .item-rarity-common {
        color: #ffffff;
      }
      .item-rarity-rare {
        color: var(--rare);
      }
      .item-rarity-legendary {
        color: var(--legendary);
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div id="profile-btn">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
      <div class="balance" id="balance">1000 coins</div>
    </div>

    <div class="container">
      <h2 style="text-align: center; margin-top: 10px">–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å</h2>

      <!-- –û—Ä—É–∂–µ–π–Ω—ã–π –∫–µ–π—Å -->
      <div class="case">
        <img src="weapon_case.png" class="case-image" alt="–û—Ä—É–∂–µ–π–Ω—ã–π –∫–µ–π—Å" />
        <h3>–û—Ä—É–∂–µ–π–Ω—ã–π –∫–µ–π—Å</h3>
        <p>–¶–µ–Ω–∞: 100 coins</p>
        <button class="open-btn" onclick="openCase('weapon')">–û—Ç–∫—Ä—ã—Ç—å</button>
      </div>

      <!-- –ù–æ–∂–µ–≤–æ–π –∫–µ–π—Å -->
      <div class="case">
        <img src="knife_case.png" class="case-image" alt="–ù–æ–∂–µ–≤–æ–π –∫–µ–π—Å" />
        <h3>–ù–æ–∂–µ–≤–æ–π –∫–µ–π—Å</h3>
        <p>–¶–µ–Ω–∞: 500 coins</p>
        <button class="open-btn" onclick="openCase('knife')">–û—Ç–∫—Ä—ã—Ç—å</button>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
      <button
        class="open-btn"
        style="display: block; margin: 20px auto"
        onclick="showDepositModal()"
      >
        üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
      </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="modal" id="profile-modal">
      <div class="modal-content">
        <h3>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h3>
        <div id="profile-data">
          <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º:</p>
          <input type="text" id="username" placeholder="–ù–∏–∫–Ω–µ–π–º" />
          <button class="open-btn" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
    <div class="modal" id="deposit-modal">
      <div class="modal-content">
        <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É (1 coin = 1 —Ä—É–±–ª—å):</p>
        <div style="display: flex; gap: 10px; margin: 15px 0">
          <button
            class="open-btn"
            style="flex: 1"
            onclick="setDepositAmount(100)"
          >
            100
          </button>
          <button
            class="open-btn"
            style="flex: 1"
            onclick="setDepositAmount(500)"
          >
            500
          </button>
          <button
            class="open-btn"
            style="flex: 1"
            onclick="setDepositAmount(1000)"
          >
            1000
          </button>
        </div>
        <input
          type="number"
          id="custom-amount"
          placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é —Å—É–º–º—É"
          min="1"
          max="3000"
        />
        <button
          class="open-btn"
          style="margin-top: 15px"
          onclick="processDeposit()"
        >
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
        </button>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–ª–∞—Ç–µ–∂–∞ -->
    <div class="modal" id="payment-modal">
      <div class="modal-content">
        <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–ø–ª–∞—Ç–µ</h3>
        <p>–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ <span id="payment-amount">100</span> —Ä—É–±–ª–µ–π –Ω–∞ –∫–∞—Ä—Ç—É:</p>
        <p style="font-weight: bold; font-size: 18px">2200 7007 1260 4007</p>
        <p>–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç @qwrie211</p>
        <button class="open-btn" onclick="closePaymentModal()">
          –Ø –æ–ø–ª–∞—Ç–∏–ª
        </button>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div class="modal" id="result-modal">
      <div class="modal-content" style="text-align: center">
        <h3 id="result-title">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h3>
        <img
          id="result-image"
          src=""
          style="width: 150px; height: 150px; object-fit: contain"
        />
        <p id="result-name" style="font-size: 18px; font-weight: bold"></p>
        <p id="result-rarity"></p>
        <button class="open-btn" onclick="closeResultModal()">OK</button>
      </div>
    </div>

    <script>
      // –î–∞–Ω–Ω—ã–µ –∫–µ–π—Å–æ–≤
      const cases = {
        weapon: {
          name: "–û—Ä—É–∂–µ–π–Ω—ã–π –∫–µ–π—Å",
          price: 100,
          items: [
            {
              name: "AK-47 | –ö—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è",
              rarity: "rare",
              image: "ak_redline.png",
              value: 200,
            },
            {
              name: "AWP | –ß–µ—Ä–Ω—ã–π –≥—Ä–∏—Ñ–æ–Ω",
              rarity: "common",
              image: "awp_gryphon.png",
              value: 50,
            },
            {
              name: "M4A4 | –ò–º–ø–µ—Ä–∞—Ç–æ—Ä",
              rarity: "legendary",
              image: "m4a4_emperor.png",
              value: 500,
            },
          ],
        },
        knife: {
          name: "–ù–æ–∂–µ–≤–æ–π –∫–µ–π—Å",
          price: 500,
          items: [
            {
              name: "–ö–µ—Ä–∞–º–±–∏—Ç | –£–ª—å—Ç—Ä–∞—Ñ–∏–æ–ª–µ—Ç",
              rarity: "legendary",
              image: "karambit_ultraviolet.png",
              value: 1000,
            },
            {
              name: "–ù–∞–≤–∞—Ö–∞ | –ö—Ä–æ–≤–∞–≤–∞—è –ø–∞—É—Ç–∏–Ω–∞",
              rarity: "rare",
              image: "navaja_web.png",
              value: 600,
            },
            {
              name: "–ë–∞–±—É—Ç–∫–∞ | –°–∏–Ω–∏–π —Å—Ç–∞–ª—å–Ω–æ–π",
              rarity: "rare",
              image: "butterfly_blue.png",
              value: 700,
            },
          ],
        },
      };

      // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      let userData = {
        balance: 1000,
        username: null,
        userId: Math.floor(Math.random() * 1000000),
        inventory: [],
      };

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
      Telegram.WebApp.expand();
      Telegram.WebApp.ready();

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
      function updateBalance() {
        document.getElementById(
          "balance"
        ).textContent = `${userData.balance} coins`;
      }

      // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞
      function openCase(caseType) {
        const caseData = cases[caseType];

        if (userData.balance < caseData.price) {
          alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
          return;
        }

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —à–∞–Ω—Å–æ–≤
        const totalProbability = caseData.items.reduce((sum, item) => {
          if (item.rarity === "common") return sum + 70;
          if (item.rarity === "rare") return sum + 25;
          return sum + 5; // legendary
        }, 0);

        const randomNum = Math.random() * totalProbability;
        let cumulative = 0;
        let selectedItem = null;

        for (const item of caseData.items) {
          let prob = 0;
          if (item.rarity === "common") prob = 70;
          else if (item.rarity === "rare") prob = 25;
          else prob = 5; // legendary

          cumulative += prob;
          if (randomNum <= cumulative) {
            selectedItem = item;
            break;
          }
        }

        userData.balance -= caseData.price;
        userData.inventory.push(selectedItem);
        updateBalance();
        showResult(selectedItem);
      }

      // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      function showResult(item) {
        document.getElementById("result-title").textContent = "üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!";
        document.getElementById("result-name").textContent = item.name;
        document.getElementById(
          "result-rarity"
        ).innerHTML = `–†–µ–¥–∫–æ—Å—Ç—å: <span class="item-rarity-${item.rarity}">${item.rarity}</span>`;
        document.getElementById("result-image").src = item.image;
        document.getElementById("result-modal").style.display = "flex";
      }

      // –†–∞–±–æ—Ç–∞ —Å –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
      function showProfileModal() {
        document.getElementById("profile-modal").style.display = "flex";
      }

      function showDepositModal() {
        document.getElementById("deposit-modal").style.display = "flex";
      }

      function closeModals() {
        document.getElementById("profile-modal").style.display = "none";
        document.getElementById("deposit-modal").style.display = "none";
        document.getElementById("payment-modal").style.display = "none";
        document.getElementById("result-modal").style.display = "none";
      }

      function closeResultModal() {
        document.getElementById("result-modal").style.display = "none";
      }

      function setDepositAmount(amount) {
        document.getElementById("custom-amount").value = amount;
      }

      function processDeposit() {
        const amount = parseInt(document.getElementById("custom-amount").value);
        if (isNaN(amount) || amount < 1 || amount > 3000) {
          alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –æ—Ç 1 –¥–æ 3000");
          return;
        }

        document.getElementById("payment-amount").textContent = amount;
        document.getElementById("deposit-modal").style.display = "none";
        document.getElementById("payment-modal").style.display = "flex";
      }

      function closePaymentModal() {
        closeModals();
        alert("–ë–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º");
      }

      function saveProfile() {
        const username = document.getElementById("username").value.trim();
        if (username) {
          userData.username = username;
          document.getElementById("profile-data").innerHTML = `
                    <p>–ù–∏–∫: ${username}</p>
                    <p>ID: ${userData.userId}</p>
                    <p>–ë–∞–ª–∞–Ω—Å: ${userData.balance} coins</p>
                    <p>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å: ${userData.inventory.length} –ø—Ä–µ–¥–º–µ—Ç–æ–≤</p>
                `;
        }
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      document
        .getElementById("profile-btn")
        .addEventListener("click", showProfileModal);
      document.addEventListener("click", (e) => {
        if (e.target.classList.contains("modal")) {
          closeModals();
        }
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      updateBalance();
    </script>
  </body>
</html>
