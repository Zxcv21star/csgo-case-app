<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS:GO Case Opening</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --case-color: #2a2a2e;
            --primary: #5d8aff;
            --rare: #ffcc00;
            --legendary: #ff4d4d;
        }
        body {
            font-family: 'Arial', sans-serif;
            background: var(--bg-color);
            color: white;
            margin: 0;
            padding: 0;
        }
        .header {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #2a2a2a;
        }
        .balance {
            background: var(--primary);
            padding: 5px 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        .case {
            background: var(--case-color);
            border-radius: 15px;
            margin: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.3s;
        }
        .case:hover {
            transform: scale(1.03);
            cursor: pointer;
        }
        .case-image {
            width: 200px;
            height: 150px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        .btn {
            background: var(--primary);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: var(--case-color);
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
        }
        .item-card {
            display: inline-block;
            width: 120px;
            margin: 10px;
            text-align: center;
        }
        .item-image {
            width: 100px;
            height: 100px;
            object-fit: contain;
        }
        .rarity-common { color: white; }
        .rarity-rare { color: var(--rare); }
        .rarity-legendary { color: var(--legendary); }
        .promo-input {
            padding: 10px;
            border-radius: 10px;
            border: none;
            width: 100%;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <div id="profile-btn" onclick="showAuthModal()">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="balance" id="balance">0 coins</div>
    </div>

    <div class="container">
        <h2 style="text-align: center; margin-top: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å</h2>
        
        <div class="case" onclick="showCaseContents('weapon')">
            <img src="images/cases/weapon_case.png" class="case-image" alt="–û—Ä—É–∂–µ–π–Ω—ã–π –∫–µ–π—Å">
            <h3>–û—Ä—É–∂–µ–π–Ω—ã–π –∫–µ–π—Å</h3>
            <p>–¶–µ–Ω–∞: 100 coins</p>
        </div>

        <div class="case" onclick="showCaseContents('knife')">
            <img src="images/cases/knife_case.png" class="case-image" alt="–ù–æ–∂–µ–≤–æ–π –∫–µ–π—Å">
            <h3>–ù–æ–∂–µ–≤–æ–π –∫–µ–π—Å</h3>
            <p>–¶–µ–Ω–∞: 500 coins</p>
        </div>

        <button class="btn" style="display: block; margin: 20px auto;" onclick="showPromoModal()">
            üéÅ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
        </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="modal" id="auth-modal">
        <div class="modal-content">
            <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–í—Ö–æ–¥</h3>
            <div id="auth-step-1">
                <input type="email" id="auth-email" class="promo-input" placeholder="–í–∞—à email">
                <button class="btn" onclick="sendVerificationCode()">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
            </div>
            <div id="auth-step-2" style="display: none;">
                <p>–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email</p>
                <input type="text" id="auth-code" class="promo-input" placeholder="–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è">
                <button class="btn" onclick="verifyCode()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞ -->
    <div class="modal" id="promo-modal">
        <div class="modal-content">
            <h3>–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞</h3>
            <input type="text" id="promo-code" class="promo-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
            <button class="btn" onclick="activatePromoCode()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn" onclick="closeModal('promo-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–µ–π—Å–∞ -->
    <div class="modal" id="case-contents-modal">
        <div class="modal-content">
            <h3 id="case-title">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–µ–π—Å–∞</h3>
            <div id="case-items-container"></div>
            <button class="btn" onclick="startCaseOpening()">–û—Ç–∫—Ä—ã—Ç—å (<span id="case-price">100</span> coins)</button>
            <button class="btn" onclick="closeModal('case-contents-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –∫–µ–π—Å–æ–≤
        const cases = {
            weapon: {
                name: "–û—Ä—É–∂–µ–π–Ω—ã–π –∫–µ–π—Å",
                price: 100,
                items: [
                    { name: "AK-47 | –ö—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è", rarity: "rare", image: "images/items/ak_redline.png", value: 200 },
                    { name: "AWP | –ß–µ—Ä–Ω—ã–π –≥—Ä–∏—Ñ–æ–Ω", rarity: "common", image: "images/items/awp_gryphon.png", value: 50 },
                    { name: "M4A4 | –ò–º–ø–µ—Ä–∞—Ç–æ—Ä", rarity: "legendary", image: "images/items/m4a4_emperor.png", value: 500 }
                ]
            },
            knife: {
                name: "–ù–æ–∂–µ–≤–æ–π –∫–µ–π—Å",
                price: 500,
                items: [
                    { name: "–ö–µ—Ä–∞–º–±–∏—Ç | –£–ª—å—Ç—Ä–∞—Ñ–∏–æ–ª–µ—Ç", rarity: "legendary", image: "images/items/karambit_ultraviolet.png", value: 1000 },
                    { name: "–ù–∞–≤–∞—Ö–∞ | –ö—Ä–æ–≤–∞–≤–∞—è –ø–∞—É—Ç–∏–Ω–∞", rarity: "rare", image: "images/items/navaja_web.png", value: 600 },
                    { name: "–ë–∞–±—É—Ç–∫–∞ | –°–∏–Ω–∏–π —Å—Ç–∞–ª—å–Ω–æ–π", rarity: "rare", image: "images/items/butterfly_blue.png", value: 700 }
                ]
            }
        };

        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userData = {
            email: null,
            balance: 0,
            inventory: [],
            verified: false
        };

        let currentCase = null;
        let verificationCode = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        Telegram.WebApp.expand();
        Telegram.WebApp.ready();

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–µ–π—Å–∞
        function showCaseContents(caseType) {
            currentCase = caseType;
            const caseData = cases[caseType];
            document.getElementById('case-title').textContent = caseData.name;
            document.getElementById('case-price').textContent = caseData.price;
            
            const container = document.getElementById('case-items-container');
            container.innerHTML = '';
            
            caseData.items.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';
                itemCard.innerHTML = `
                    <img src="${item.image}" class="item-image">
                    <p class="rarity-${item.rarity}">${item.name}</p>
                    <p>${item.value} coins</p>
                `;
                container.appendChild(itemCard);
            });
            
            openModal('case-contents-modal');
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞
        function startCaseOpening() {
            if (userData.balance < cases[currentCase].price) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
                return;
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç
            const caseItems = cases[currentCase].items;
            const randomItem = caseItems[Math.floor(Math.random() * caseItems.length)];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            userData.inventory.push(randomItem);
            userData.balance -= cases[currentCase].price;
            updateBalance();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            alert(`–í—ã –ø–æ–ª—É—á–∏–ª–∏: ${randomItem.name} (${randomItem.rarity})`);
            closeModal('case-contents-modal');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            saveUserData();
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        function showAuthModal() {
            if (userData.email) {
                alert(`–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: ${userData.email}\n–ë–∞–ª–∞–Ω—Å: ${userData.balance} coins`);
                return;
            }
            openModal('auth-modal');
        }

        async function sendVerificationCode() {
            const email = document.getElementById('auth-email').value;
            if (!email.includes('@')) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
                return;
            }
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ: –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            verificationCode = Math.floor(100000 + Math.random() * 900000);
            alert(`–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: ${verificationCode} (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email)`);
            
            document.getElementById('auth-step-1').style.display = 'none';
            document.getElementById('auth-step-2').style.display = 'block';
        }

        function verifyCode() {
            const code = document.getElementById('auth-code').value;
            if (code == verificationCode) {
                userData.email = document.getElementById('auth-email').value;
                userData.balance = 1000; // –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
                userData.verified = true;
                updateBalance();
                closeModal('auth-modal');
                saveUserData();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥');
            }
        }

        // –ü—Ä–æ–º–æ–∫–æ–¥—ã
        function showPromoModal() {
            if (!userData.email) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç');
                showAuthModal();
                return;
            }
            openModal('promo-modal');
        }

        function activatePromoCode() {
            const code = document.getElementById('promo-code').value;
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ: –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            const promoRewards = {
                'FREECOINS': { type: 'currency', value: 500 },
                'FREECASE': { type: 'case', value: 'weapon' },
                'LEGENDARY': { type: 'item', value: cases.knife.items[0] }
            };
            
            if (promoRewards[code]) {
                const reward = promoRewards[code];
                if (reward.type === 'currency') {
                    userData.balance += reward.value;
                    updateBalance();
                    alert(`+${reward.value} coins!`);
                } else if (reward.type === 'case') {
                    currentCase = reward.value;
                    showCaseContents(currentCase);
                } else if (reward.type === 'item') {
                    userData.inventory.push(reward.value);
                    alert(`–ü–æ–ª—É—á–µ–Ω: ${reward.value.name}`);
                }
                saveUserData();
                closeModal('promo-modal');
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveUserData() {
            if (userData.email) {
                localStorage.setItem('csgoUserData', JSON.stringify(userData));
            }
        }

        function loadUserData() {
            const savedData = localStorage.getItem('csgoUserData');
            if (savedData) {
                userData = JSON.parse(savedData);
                updateBalance();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateBalance() {
            document.getElementById('balance').textContent = `${userData.balance} coins`;
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
        function openModal(id) {
            document.getElementById(id).style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadUserData();
    </script>
</body>
</html>
